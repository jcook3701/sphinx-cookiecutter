# Makefile
# =========================================
# Project: github-docs for sphinx-cookiecutter
# =========================================

# --------------------------------------------------
# ‚öôÔ∏è Environment Settings
# --------------------------------------------------
SHELL := /bin/bash
.SHELLFLAGS := -O globstar -c
# If V is set to '1' or 'y' on the command line,
# AT will be empty (verbose).  Otherwise, AT will
# contain '@' (quiet by default).  The '?' is a
# conditional assignment operator: it only sets V
# if it hasn't been set externally.
V ?= 0
ifeq ($(V),0)
    AT = @
else
    AT =
endif
# Detect if we are running inside GitHub Actions CI.
# GitHub sets the environment variable GITHUB_ACTIONS=true in workflows.
# We set CI=1 if running in GitHub Actions, otherwise CI=0 for local runs.
ifeq ($(GITHUB_ACTIONS),true)
CI := 1
else
CI := 0
endif
# Define a reusable CI-safe runner
define run_ci_safe =
( $1 || [ "$(CI)" != "1" ] )
endef
# --------------------------------------------------
# ‚öôÔ∏è Build Settings
# --------------------------------------------------
PACKAGE_NAME = "sphinx-cookiecutter"
AUTHOR = "Jared Cook"
VERSION = "0.1.0"
PUBLISHDIR ?=
# --------------------------------------------------
# üìö Documentation (Sphinx + Jekyll)
# --------------------------------------------------
RUBY_INSTALL := bundle install
JEKYLL_BUILD := bundle exec jekyll build --trace --verbose
JEKYLL_CLEAN := bundle exec jekyll clean
JEKYLL_SERVE := bundle exec jekyll serve
# --------------------------------------------------
.PHONY: all ruby-install jekyll jekyll-serve build run clean help
# --------------------------------------------------
# Default:
# --------------------------------------------------
all: ruby-install build
# --------------------------------------------------
# ‚ô¶Ô∏è Ruby
# --------------------------------------------------
ruby-install:
	$(AT)$(RUBY_INSTALL)
# --------------------------------------------------
# üìö Documentation (Jekyll)
# --------------------------------------------------
jekyll:
	$(AT)echo "üî® Building Jekyll site üìö..."
	$(AT)$(JEKYLL_BUILD)
	$(AT)echo "‚úÖ Full documentation build complete!"

jekyll-serve:
	$(AT)echo "üöÄ Starting Jekyll development server..."
	$(AT)$(JEKYLL_SERVE)

build: jekyll
run: jekyll-serve
# --------------------------------------------------
# üßπ Clean artifacts
# --------------------------------------------------
clean:
	$(AT)echo "üßπ Cleaning Jekyll build artifacts..."
	$(AT)$(call run_ci_safe,$(JEKYLL_CLEAN))
	$(AT)echo "‚úÖ Cleaned Jekyll build artifacts."
# --------------------------------------------------
# Help
# --------------------------------------------------
help:
	$(AT)echo "üì¶ $(PACKAGE_NAME) github documentation Makefile"
	$(AT)echo "   author: $(PACKAGE_AUTHOR)"
	$(AT)echo "   version: $(PACKAGE_VERSION)"
	$(AT)echo ""
	$(AT)echo "Usage:"
	$(AT)echo "  make ruby-install           Installs Gemfile packages."
	$(AT)echo "  make build                  Generate Jekyll documentation"
	$(AT)echo "  make run                    Serve Jekyll site locally"
	$(AT)echo "  make clean                  Clean Jekyll build artifacts"
	$(AT)echo "  make all                    Run make (build)"
	$(AT)echo "Options:"
	$(AT)echo "  V=1             Enable verbose output (show all commands being executed)"
	$(AT)echo "  make -s         Run completely silently (suppress make's own output AND command echo)"
